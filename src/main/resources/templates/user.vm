<div id="speakeasy-user-main">
    <script type="text/javascript">
        var staticResourcesPrefix = "$staticResourcesPrefix";
        var contextPath = "$contextPath";
        var plugins = $plugins.renderJson;
        var currentUser = "$user";
        var product = "$product";
    </script>

    <script type="text/x-template" title="download-dialog">
        <p>
            This will create an AMPS project for the extension '{pluginKey}'.
            To use it:
        </p>
        <ol>
            <li>Unzip the file into an empty directory</li>
            <li>Start the target product with the extension installed by running:
<pre>
mvn {product}:run
</pre></li>
            <li>Edit the extension files, usually in <code>src/main/resources</code>, and refresh your browser
            to see the changes.</li>
        </ol>
        <a id="download-link" href="{href}">Download</a>
    </script>

    <script type="text/x-template" title="fork-dialog">
        <p>
            This will create a fork of the extension '{pluginKey}'
        </p>
        <form id="fork-form" class="aui top-label">
            <fieldset>
                <div class="field-group">
                    <label for="fork-description">New Description</label>
                    <textarea name="fork-description" id="fork-description" cols="40" rows="5">{description}</textarea>
                    <div class="description">A few words on why you are forking</div>
                </div>
            <fieldset>
        </form>
    </script>

    <script type="text/x-template" title="browser-leaf">
        <li><span class="{class}">{text}</span>{children}</li>
    </script>


    <script type="text/x-template" title="ide-dialog">
        <div id="ide-content">
            {firstScript}
            <div id="ide-file-contents-panel">
                <b>Contents</b>
                <ul id="ide-browser" class="filetree">
                </ul>
            </div>
            <div id="ide-main-content">
                <div id="ide-loading" style="padding: 100px;">
                    <img alt="waiting" src="$staticResourcesPrefix/download/resources/com.atlassian.labs.speakeasy-plugin:optin-js/wait.gif" align="absmiddle" /> Loading IDE... </p>
                </div>
                <textarea id="ide-editor" style="display: none;">
                </textarea>
            </div>
            <div id="ide-status">
                <span>Status: </span><span id="ide-status-text"></span>
            </div>
        </div>
    </script>

    <script type="text/x-template" title="uninstall-action">
        <a class="pk-uninstall"  href="$contextPath/rest/speakeasy/1/plugins/{key}">Uninstall</a>
    </script>
    <script type="text/x-template" title="edit-action">
        <a class="pk-edit" href="$contextPath/rest/speakeasy/1/plugins/{key}/index">Edit</a>
    </script>
    <script type="text/x-template" title="fork-action">
        <a class="pk-fork" href="$contextPath/rest/speakeasy/1/plugins/fork/{key}">Fork</a>
    </script>
    <script type="text/x-template" title="disable-action">
        <a class="pk-disable" href="$contextPath/rest/speakeasy/1/user/{key}">Disable</a>
    </script>
    <script type="text/x-template" title="enable-action">
        <a class="pk-enable" href="$contextPath/rest/speakeasy/1/user/{key}">Enable</a>
    </script>
    <script type="text/x-template" title="download-action">
        <a class="pk-download" href="$contextPath/rest/speakeasy/1/plugins/download/{key}.zip">Download</a>
    </script>
    <script type="text/x-template" title="row">
        <tr data-pluginKey="{key}">
            <td headers="plugin-name"><div class="plugin-summary"><span class="plugin-name">{name}</span><br><span class="plugin-description">{description}</span></div></td>
            <td headers="plugin-author">{author}</td>
            <td headers="plugin-version">{version}</td>
            <td headers="plugin-users">{numUsers}</td>
            <td headers="plugin-actions">
                {actions}
            </td>
        </tr>
    </script>

    <script type="text/x-template" title="available-extension-row">
        <tr data-pluginKey="{key}">
            <td headers="plugin-name"><span class="plugin-name">{name}</span><br><span class="plugin-description">{description}</span></td>
            <td headers="plugin-author"><a href="{authorUrl}">{author}</a></td>
            <td headers="plugin-version">{version}</td>
            <td headers="plugin-actions" nowrap="true">
                <a href="{binaryUrl}"'>Download</a>
                <a href="http://plugins.atlassian.com/{id}">Learn More</a>
            </td>
        </tr>
    </script>

<div style="margin-top: -55px; margin-left: 350px;" id="aui-message-bar"> </div>

<div class="aui-tabs horizontal-tabs" id="horizontal">
    <ul class="tabs-menu">
        <li class="menu-item active-tab">
            <a href="#horizontal-first"><strong>Installed Extensions</strong></a>
        </li>
        <li class="menu-item">
            <a href="#horizontal-second" id="available-extensions-tab"><strong>Available Extensions</strong></a>
        </li>
    </ul>
    <div class="tabs-pane active-pane" id="horizontal-first">
        <p style="margin: 10px 0 15px 0;">
            These are the extensions installed on your server.<br />
            To use an extension, click <b>Enable</b>. <br />
            To upload a new extension, use the <b>Upload</b> form.<br />
            To develop your own extensions, <a href="mailto:don@atlassian.com">learn more</a>.
        </p>
        <table class="aui" id="plugins-table">
        <thead>
            <tr>
                <th id="plugin-name">Name</th>
                <th id="plugin-author">Author</th>
                <th id="plugin-version">Version</th>
                <th id="plugin-users">Users</th>
                <th id="action">Action</th>
            </tr>
        </thead>
        <tbody id="plugins-table-body">

        </tbody>
        </table>


        #if ($devmode && $installAllowed)
            <div style="background-color: #f0f0f0; margin: 20px; padding: 10px; border: 1px solid #bbb;">
                <form id="upload-form" action="$contextPath/rest/speakeasy/1/plugins" enctype="multipart/form-data" method="post">
                    <b>Upload New Extension:</b>
                    <label for="plugin-file">Install a new extension by uploading from your computer:</label> <input id="plugin-file" type="file" name="plugin-file" size="40">
                </form>
            </div>
        #end
    </div>
    <div class="tabs-pane" id="horizontal-second">
        <p style="margin: 10px 0 15px 0;">
            These extensions are hosted on <a href="http://plugins.atlassian.com">http://plugins.atlassian.com</a>.<br />
            To install an extension, <b>Download</b> it locally, then <b>Upload</b> it to Speakeasy. <br />
            You should consult the extension's page before installing - click <b>Learn More</b>.<br />
        </p>

        <div class="aui-message warning">
            <p class="title">These are not the extensions you're looking for!</p>
            <p>
                Yes - the items below are not extensions because extensions don't have a category on PAC yet.
                This is a proof of concept of accessing PAC via Javascript + REST + DropBox + YQL from within the browser. It's all very shiny, new and cool.
            </p>
            <p>
                When Speakeasy is released there will be a PAC extensions category per product. Those contents will show up below. We will also indicate which ones you already have installed etc.
            </p>
            <p>
                If you want to share extensions, for now please attach them to <a href="https://extranet.atlassian.com/x/pJrEbw">this EAC page</a>.
            </p>
        </div>
        
        <p id="loading"><img alt="waiting"
align="absmiddle" src="$staticResourcesPrefix/download/resources/com.atlassian.labs.speakeasy-plugin:optin-js/wait.gif" /> Loading available extensions from plugins.atlassian.com ..</p>

        <table class="aui" id="available-extensions-table">
        <thead>
            <tr>
                <th id="plugin-name">Name</th>
                <th id="plugin-author">Author</th>
                <th id="plugin-version">Version</th>
                <th id="action">Action</th>
            </tr>
        </thead>
        <tbody id="available-extensions-tableBody">

        </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">
        initSpeakeasy();
</script>
</div>
